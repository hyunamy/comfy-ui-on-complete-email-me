name: hyunamy
on:
  # 수동으로 워크플로우를 실행할 수 있는 기능을 추가
  workflow_dispatch:
  push:
    branches:
      - master  # 'master' 브랜치에서 push 이벤트 발생 시 실행
    paths:
      - "pyproject.toml"  # 'pyproject.toml' 파일이 변경될 때만 실행

jobs:
  publish-node:
    name: Publish Custom Node
    runs-on: ubuntu-latest
    # 포크된 저장소인 경우 워크플로우 건너뛰기
    if: github.event.repository.fork == false 
    steps:
      - name: Check out code
        uses: actions/checkout@v4  # 최신 버전의 checkout 액션 사용
      - name: Publish Custom Node
        uses: Comfy-Org/publish-node-action@main
        with:
          # GitHub Repository secrets에 추가한 개인 접근 토큰 사용
          personal_access_token: ${{ secrets.REGISTRY_ACCESS_TOKEN }}

      # 추가: 오류 발생 시 알림을 보내는 단계 (선택 사항)
      - name: Notify on failure
        if: failure()
        runs-on: ubuntu-latest
        steps:
          - name: Send notification
            uses: some/notification-action@v1
            with:
              message: "Publishing failed!"
